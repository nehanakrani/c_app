import{Controller as e}from"stimulus";import t from"cable_ready";import{createConsumer as r}from"@rails/actioncable";const uuidv4=()=>{const e=window.crypto||window.msCrypto;return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^e.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))};const serializeForm=(e,t={})=>{if(!e)return"";const r=t.w||window;const{element:l}=t;const n=new r.FormData(e);const o=Array.from(n,(e=>e.map(encodeURIComponent).join("=")));const s=e.querySelector("input[type=submit]");l&&l.name&&"INPUT"===l.nodeName&&"submit"===l.type?o.push(`${encodeURIComponent(l.name)}=${encodeURIComponent(l.value)}`):s&&s.name&&o.push(`${encodeURIComponent(s.name)}=${encodeURIComponent(s.value)}`);return Array.from(o).join("&")};const camelize=(e,t=true)=>{if("string"!==typeof e)return"";e=e.replace(/[\s_](.)/g,(e=>e.toUpperCase())).replace(/[\s_]/g,"").replace(/^(.)/,(e=>e.toLowerCase()));t&&(e=e.substr(0,1).toUpperCase()+e.substr(1));return e};const debounce=(e,t=250)=>{let r;return(...l)=>{clearTimeout(r);r=setTimeout((()=>{r=null;e(...l)}),t)}};const extractReflexName=e=>{const t=e.match(/(?:.*->)?(.*?)(?:Reflex)?#/);return t?t[1]:""};const emitEvent=(e,t)=>{document.dispatchEvent(new CustomEvent(e,{bubbles:true,cancelable:false,detail:t}));window.jQuery&&window.jQuery(document).trigger(e,t)};const elementToXPath=e=>{if(""!==e.id)return"//*[@id='"+e.id+"']";if(e===document.body)return"/html/body";let t=0;const r=e.parentNode.childNodes;for(var l=0;l<r.length;l++){const n=r[l];if(n===e){const r=elementToXPath(e.parentNode);const l=e.tagName.toLowerCase();const n=t+1;return`${r}/${l}[${n}]`}1===n.nodeType&&n.tagName===e.tagName&&t++}};const XPathToElement=e=>document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;const XPathToArray=(e,t=false)=>{const r=document.evaluate(e,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);const l=[];for(let e=0;e<r.snapshotLength;e++)l.push(r.snapshotItem(e));return t?l.reverse():l};let l=false;var n={get enabled(){return l},get disabled(){return!l},get value(){return l},set(e){l=!!e},set debug(e){l=!!e}};const o={reflexAttribute:"data-reflex",reflexPermanentAttribute:"data-reflex-permanent",reflexRootAttribute:"data-reflex-root",reflexSuppressLoggingAttribute:"data-reflex-suppress-logging",reflexDatasetAttribute:"data-reflex-dataset",reflexDatasetAllAttribute:"data-reflex-dataset-all",reflexSerializeFormAttribute:"data-reflex-serialize-form",reflexFormSelectorAttribute:"data-reflex-form-selector",reflexIncludeInnerHtmlAttribute:"data-reflex-include-inner-html",reflexIncludeTextContentAttribute:"data-reflex-include-text-content"};let s={};var a={set(e){s={...o,...e.schema};for(const e in s)Object.defineProperty(this,e.slice(0,-9),{get:()=>s[e]})}};let i=false;var c={get disabled(){return!i},set(e){i=e}};let u=true;var d={get enabled(){return u},get disabled(){return!u},get value(){return u},set(e){u=!!e},set deprecate(e){u=!!e}};const multipleInstances=e=>!!["checkbox","radio"].includes(e.type)&&document.querySelectorAll(`input[type="${e.type}"][name="${e.name}"]`).length>1;const collectCheckedOptions=e=>Array.from(e.querySelectorAll("option:checked")).concat(Array.from(document.querySelectorAll(`input[type="${e.type}"][name="${e.name}"]`)).filter((e=>e.checked))).map((e=>e.value));const attributeValue=(e=[])=>{const t=e.filter((e=>e&&String(e).length)).map((e=>e.trim())).join(" ").trim();return t.length?t:null};const attributeValues=e=>e&&e.length?e.split(" ").filter((e=>e.trim().length)):[];const extractElementAttributes=e=>{let t=Array.from(e.attributes).reduce(((e,t)=>{e[t.name]=t.value;return e}),{});t.checked=!!e.checked;t.selected=!!e.selected;t.tag_name=e.tagName;if(e.tagName.match(/select/i)||multipleInstances(e)){const r=collectCheckedOptions(e);t.values=r;t.value=r.join(",")}else t.value=e.value;return t};const getElementsFromTokens=(e,t)=>{if(!t||0===t.length)return[];let r=[e];const l=elementToXPath(e);t.forEach((e=>{try{switch(e){case"combined":d.enabled&&console.warn("In the next version of StimulusReflex, the 'combined' option to data-reflex-dataset will become 'ancestors'.");r=[...r,...XPathToArray(`${l}/ancestor::*`,true)];break;case"ancestors":r=[...r,...XPathToArray(`${l}/ancestor::*`,true)];break;case"parent":r=[...r,...XPathToArray(`${l}/parent::*`)];break;case"siblings":r=[...r,...XPathToArray(`${l}/preceding-sibling::*|${l}/following-sibling::*`)];break;case"children":r=[...r,...XPathToArray(`${l}/child::*`)];break;case"descendants":r=[...r,...XPathToArray(`${l}/descendant::*`)];break;default:r=[...r,...document.querySelectorAll(e)]}}catch(e){n.enabled&&console.error(e)}}));return r};const extractElementDataset=e=>{const t=e.attributes[a.reflexDataset];const r=e.attributes[a.reflexDatasetAll];const l=t&&t.value.split(" ")||[];const n=r&&r.value.split(" ")||[];const o=getElementsFromTokens(e,l);const s=getElementsFromTokens(e,n);const i=o.reduce(((e,t)=>({...extractDataAttributes(t),...e})),{});const c=extractDataAttributes(e);const u={dataset:{...c,...i},datasetAll:{}};s.forEach((e=>{const t=extractDataAttributes(e);Object.keys(t).forEach((e=>{const r=t[e];u.datasetAll[e]&&Array.isArray(u.datasetAll[e])?u.datasetAll[e].push(r):u.datasetAll[e]=[r]}))}));return u};const extractDataAttributes=e=>{let t={};e&&e.attributes&&Array.from(e.attributes).forEach((e=>{e.name.startsWith("data-")&&(t[e.name]=e.value)}));return t};const localReflexControllers=(e,t)=>attributeValues(t.getAttribute(a.controller)).reduce(((r,l)=>{const n=e.getControllerForElementAndIdentifier(t,l);n&&n.StimulusReflex&&r.push(n);return r}),[]);const allReflexControllers=(e,t)=>{let r=[];while(t){r=r.concat(localReflexControllers(e,t));t=t.parentElement}return r};const findControllerByReflexName=(e,t)=>{const r=t.find((t=>{if(t.identifier)return extractReflexName(e).replace(/([a-z0â€“9])([A-Z])/g,"$1-$2").replace(/(::)/g,"--").toLowerCase()===t.identifier}));return r||t[0]};const f={};const received=e=>{if(!e.cableReady)return;let r=[];for(let t=e.operations.length-1;t>=0;t--)if(e.operations[t].stimulusReflex){r.push(e.operations[t]);e.operations.splice(t,1)}if(r.some((e=>e.stimulusReflex.url!==location.href)))return;let l;if(r.length){l=r[0].stimulusReflex;l.payload=r[0].payload}if(l){const{reflexId:n,payload:o}=l;if(!f[n]&&c.disabled){const e=XPathToElement(l.xpathController);const t=XPathToElement(l.xpathElement);e.reflexController=e.reflexController||{};e.reflexData=e.reflexData||{};e.reflexError=e.reflexError||{};e.reflexController[n]=f.app.getControllerForElementAndIdentifier(e,l.reflexController);e.reflexData[n]=l;dispatchLifecycleEvent("before",t,e,n,o);registerReflex(l)}if(f[n]){f[n].totalOperations=r.length;f[n].pendingOperations=r.length;f[n].completedOperations=0;f[n].piggybackOperations=e.operations;t.perform(r)}}else e.operations.length&&f[e.operations[0].reflexId]&&t.perform(e.operations)};const registerReflex=e=>{const{reflexId:t}=e;f[t]={finalStage:"finalize"};const r=new Promise(((r,l)=>{f[t].promise={resolve:r,reject:l,data:e}}));r.reflexId=t;n.enabled&&r.catch((()=>{}));return r};const getReflexRoots=e=>{let t=[];while(0===t.length&&e){let r=e.getAttribute(a.reflexRoot);if(r){0===r.length&&e.id&&(r=`#${e.id}`);const l=r.split(",").filter((e=>e.trim().length));n.enabled&&0===l.length&&console.error(`No value found for ${a.reflexRoot}. Add an #id to the element or provide a value for ${a.reflexRoot}.`,e);t=t.concat(l.filter((e=>document.querySelector(e))))}e=e.parentElement?e.parentElement.closest(`[${a.reflexRoot}]`):null}return t};const m=debounce((()=>{document.querySelectorAll(`[${a.reflex}]`).forEach((e=>{const t=attributeValues(e.getAttribute(a.controller));const r=attributeValues(e.getAttribute(a.reflex));const l=attributeValues(e.getAttribute(a.action));r.forEach((r=>{const n=findControllerByReflexName(r,allReflexControllers(f.app,e));let o;if(n){o=`${r.split("->")[0]}->${n.identifier}#__perform`;l.includes(o)||l.push(o)}else{o=`${r.split("->")[0]}->stimulus-reflex#__perform`;t.includes("stimulus-reflex")||t.push("stimulus-reflex");l.includes(o)||l.push(o)}}));const n=attributeValue(t);const o=attributeValue(l);n&&e.getAttribute(a.controller)!=n&&e.setAttribute(a.controller,n);o&&e.getAttribute(a.action)!=o&&e.setAttribute(a.action,o)}));emitEvent("stimulus-reflex:ready")}),20);const invokeLifecycleMethod=(e,t,r,l,n)=>{if(!r||!r.reflexData[l])return;const o=r.reflexController[l];const s=r.reflexData[l].target;const a=s.split("#")[1];const i=["before","after","finalize"].includes(e)?`${e}${camelize(a)}`:`${camelize(a,false)}${camelize(e)}`;const c=o[i];const u=["before","after","finalize"].includes(e)?`${e}Reflex`:`reflex${camelize(e)}`;const d=o[u];"function"===typeof c&&c.call(o,t,s,r.reflexError[l],l,n);"function"===typeof d&&d.call(o,t,s,r.reflexError[l],l,n);if(f[l]&&e===f[l].finalStage){Reflect.deleteProperty(r.reflexController,l);Reflect.deleteProperty(r.reflexData,l);Reflect.deleteProperty(r.reflexError,l)}};document.addEventListener("stimulus-reflex:before",(e=>invokeLifecycleMethod("before",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload)),true);document.addEventListener("stimulus-reflex:success",(e=>{invokeLifecycleMethod("success",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload);dispatchLifecycleEvent("after",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload)}),true);document.addEventListener("stimulus-reflex:nothing",(e=>{dispatchLifecycleEvent("success",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload)}),true);document.addEventListener("stimulus-reflex:error",(e=>{invokeLifecycleMethod("error",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload);dispatchLifecycleEvent("after",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload)}),true);document.addEventListener("stimulus-reflex:halted",(e=>invokeLifecycleMethod("halted",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload)),true);document.addEventListener("stimulus-reflex:after",(e=>invokeLifecycleMethod("after",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload)),true);document.addEventListener("stimulus-reflex:finalize",(e=>invokeLifecycleMethod("finalize",e.detail.element,e.detail.controller.element,e.detail.reflexId,e.detail.payload)),true);const dispatchLifecycleEvent=(e,t,r,l,o)=>{if(!r){if(n.enabled&&!f[l].warned){console.warn(`StimulusReflex was not able execute callbacks or emit events for "${e}" or later life-cycle stages for this Reflex. The StimulusReflex Controller Element is no longer present in the DOM. Could you move the StimulusReflex Controller to an element higher in your DOM?`);f[l].warned=true}return}if(!r.reflexController||r.reflexController&&!r.reflexController[l]){if(n.enabled&&!f[l].warned){console.warn(`StimulusReflex detected that the StimulusReflex Controller responsible for this Reflex has been replaced with a new instance. Callbacks and events for "${e}" or later life-cycle stages cannot be executed.`);f[l].warned=true}return}const{target:s}=r.reflexData[l]||{};const a=r.reflexController[l]||{};const i=`stimulus-reflex:${e}`;const c=`${i}:${s.split("#")[1]}`;const u={reflex:s,controller:a,reflexId:l,element:t,payload:o};const d={bubbles:true,cancelable:false,detail:u};r.dispatchEvent(new CustomEvent(i,d));r.dispatchEvent(new CustomEvent(c,d));if(window.jQuery){window.jQuery(r).trigger(i,u);window.jQuery(r).trigger(c,u)}};const request=(e,t,r,l,o,s)=>{const a=f[e];if(!n.disabled&&!a.promise.data.suppressLogging){a.timestamp=new Date;console.log(`â†‘ stimulus â†‘ ${t}`,{reflexId:e,args:r,controller:l,element:o,controllerElement:s})}};const success=(e,t)=>{const{detail:r}=e||{};const{selector:l,payload:o}=r||{};const{reflexId:s,target:a,morph:i}=r.stimulusReflex||{};const c=f[s];if(n.disabled||c.promise.data.suppressLogging)return;const u=c.totalOperations>1?` ${c.completedOperations}/${c.totalOperations}`:"";const d=c.timestamp?`in ${new Date-c.timestamp}ms`:"CLONED";const m=e.type.split(":")[1].split("-").slice(1).join("_");console.log(`â†“ reflex â†“ ${a} â†’ ${l||"âˆž"}${u} ${d}`,{reflexId:s,morph:i,operation:m,halted:t,payload:o})};const error$1=e=>{const{detail:t}=e||{};const{reflexId:r,target:l,payload:o}=t.stimulusReflex||{};const s=f[r];if(n.disabled||s.promise.data.suppressLogging)return;const a=s.timestamp?`in ${new Date-s.timestamp}ms`:"CLONED";console.log(`â†“ reflex â†“ ${l} ${a} %cERROR: ${e.detail.body}`,"color: #f00;",{reflexId:r,payload:o})};var p={request:request,success:success,error:error$1};const beforeDOMUpdate=e=>{const{stimulusReflex:t,payload:r}=e.detail||{};if(!t)return;const{reflexId:l,xpathElement:n,xpathController:o}=t;const s=XPathToElement(o);const a=XPathToElement(n);const i=f[l];const{promise:c}=i;i.pendingOperations--;if(!(i.pendingOperations>0)){t.resolveLate||setTimeout((()=>c.resolve({element:a,event:e,data:c.data,payload:r,reflexId:l,toString:()=>""})));setTimeout((()=>dispatchLifecycleEvent("success",a,s,l,r)))}};const afterDOMUpdate=e=>{const{stimulusReflex:r,payload:l}=e.detail||{};if(!r)return;const{reflexId:n,xpathElement:o,xpathController:s}=r;const a=XPathToElement(s);const i=XPathToElement(o);const c=f[n];const{promise:u}=c;c.completedOperations++;p.success(e,false);if(!(c.completedOperations<c.totalOperations)){r.resolveLate&&setTimeout((()=>u.resolve({element:i,event:e,data:u.data,payload:l,reflexId:n,toString:()=>""})));setTimeout((()=>dispatchLifecycleEvent("finalize",i,a,n,l)));c.piggybackOperations.length&&t.perform(c.piggybackOperations)}};const routeReflexEvent=e=>{const{stimulusReflex:r,payload:l,name:n,body:o}=e.detail||{};const s=n.split("-")[2];if(!r||!["nothing","halted","error"].includes(s))return;const{reflexId:a,xpathElement:i,xpathController:c}=r;const u=XPathToElement(i);const d=XPathToElement(c);const m=f[a];const{promise:p}=m;if(d){d.reflexError=d.reflexError||{};"error"===s&&(d.reflexError[a]=o)}switch(s){case"nothing":nothing(e,l,p,m,u);break;case"error":error(e,l,p,m,u);break;case"halted":halted(e,l,p,m,u);break}setTimeout((()=>dispatchLifecycleEvent(s,u,d,a,l)));m.piggybackOperations.length&&t.perform(m.piggybackOperations)};const nothing=(e,t,r,l,n)=>{l.finalStage="after";p.success(e,false);setTimeout((()=>r.resolve({data:r.data,element:n,event:e,payload:t,reflexId:r.data.reflexId,toString:()=>""})))};const halted=(e,t,r,l,n)=>{l.finalStage="halted";p.success(e,true);setTimeout((()=>r.resolve({data:r.data,element:n,event:e,payload:t,reflexId:r.data.reflexId,toString:()=>""})))};const error=(e,t,r,l,n)=>{l.finalStage="after";p.error(e);setTimeout((()=>r.reject({data:r.data,element:n,event:e,payload:t,reflexId:r.data.reflexId,error:e.detail.body,toString:()=>e.detail.body})))};class ReflexData{constructor(e,t,r,l,n,o,s,a,i){this.options=e;this.reflexElement=t;this.controllerElement=r;this.reflexController=l;this.permanentAttributeName=n;this.target=o;this.args=s;this.url=a;this.tabId=i}get attrs(){this._attrs=this._attrs||this.options.attrs||extractElementAttributes(this.reflexElement);return this._attrs}get reflexId(){this._reflexId=this._reflexId||this.options.reflexId||uuidv4();return this._reflexId}get selectors(){this._selectors=this._selectors||this.options.selectors||getReflexRoots(this.reflexElement);return"string"===typeof this._selectors?[this._selectors]:this._selectors}get resolveLate(){return this.options.resolveLate||false}get dataset(){this._dataset=this._dataset||extractElementDataset(this.reflexElement);return this._dataset}get innerHTML(){return this.includeInnerHtml?this.reflexElement.innerHTML:""}get textContent(){return this.includeTextContent?this.reflexElement.textContent:""}get xpathController(){return elementToXPath(this.controllerElement)}get xpathElement(){return elementToXPath(this.reflexElement)}get formSelector(){const e=this.reflexElement.attributes[a.reflexFormSelector]?this.reflexElement.attributes[a.reflexFormSelector].value:void 0;return this.options.formSelector||e}get includeInnerHtml(){const e=this.reflexElement.attributes[a.reflexIncludeInnerHtml]||false;return!(!this.options.includeInnerHTML&&!e)&&"false"!==e.value}get includeTextContent(){const e=this.reflexElement.attributes[a.reflexIncludeTextContent]||false;return!(!this.options.includeTextContent&&!e)&&"false"!==e.value}get suppressLogging(){return this.options.suppressLogging||this.reflexElement.attributes[a.reflexSuppressLogging]||false}valueOf(){return{attrs:this.attrs,dataset:this.dataset,selectors:this.selectors,reflexId:this.reflexId,resolveLate:this.resolveLate,suppressLogging:this.suppressLogging,xpathController:this.xpathController,xpathElement:this.xpathElement,inner_html:this.innerHTML,text_content:this.textContent,formSelector:this.formSelector,reflexController:this.reflexController,permanentAttributeName:this.permanentAttributeName,target:this.target,args:this.args,url:this.url,tabId:this.tabId}}}let x;let h;let g;const createSubscription=e=>{x=x||e.application.consumer||r();const{channel:t}=e.StimulusReflex;const l={channel:t,...h};const n=JSON.stringify(l);e.StimulusReflex.subscription=x.subscriptions.findAll(n)[0]||x.subscriptions.create(l,{received:received,connected:connected,rejected:rejected,disconnected:disconnected})};const connected=()=>{g=true;document.body.classList.replace("stimulus-reflex-disconnected","stimulus-reflex-connected");emitEvent("stimulus-reflex:connected");emitEvent("stimulus-reflex:action-cable:connected")};const rejected=()=>{g=false;document.body.classList.replace("stimulus-reflex-connected","stimulus-reflex-disconnected");emitEvent("stimulus-reflex:rejected");emitEvent("stimulus-reflex:action-cable:rejected");Debug.enabled&&console.warn("Channel subscription was rejected.")};const disconnected=e=>{g=false;document.body.classList.replace("stimulus-reflex-connected","stimulus-reflex-disconnected");emitEvent("stimulus-reflex:disconnected",e);emitEvent("stimulus-reflex:action-cable:disconnected",e)};var b={consumer:x,params:h,get subscriptionActive(){return g},createSubscription:createSubscription,connected:connected,rejected:rejected,disconnected:disconnected,set(e,t){x=e;h=t}};class StimulusReflexController extends e{constructor(...e){super(...e);register(this)}}const initialize=(e,{controller:t,consumer:r,debug:l,params:o,isolate:s,deprecate:i}={})=>{b.set(r,o);document.addEventListener("DOMContentLoaded",(()=>{document.body.classList.remove("stimulus-reflex-connected");document.body.classList.add("stimulus-reflex-disconnected");d.enabled&&r&&console.warn("Deprecation warning: the next version of StimulusReflex will obtain a reference to consumer via the Stimulus application object.\nPlease add 'application.consumer = consumer' to your index.js after your Stimulus application has been established, and remove the consumer key from your StimulusReflex initialize() options object.");d.enabled&&c.disabled&&console.warn("Deprecation warning: the next version of StimulusReflex will standardize isolation mode, and the isolate option will be removed.\nPlease update your applications to assume that every tab will be isolated.")}),{once:true});c.set(!!s);f.app=e;a.set(e);f.app.register("stimulus-reflex",t||StimulusReflexController);n.set(!!l);"undefined"!==typeof i&&d.set(i);const u=new MutationObserver(m);u.observe(document.documentElement,{attributeFilter:[a.reflex,a.action],childList:true,subtree:true})};const register=(e,t={})=>{const r="StimulusReflex::Channel";e.StimulusReflex={...t,channel:r};b.createSubscription(e);Object.assign(e,{isActionCableConnectionOpen(){return this.StimulusReflex.subscription.consumer.connection.isOpen()},stimulate(){const e=location.href;const t=Array.from(arguments);const r=t.shift()||"StimulusReflex::Reflex#default_reflex";const l=this.element;const o=t[0]&&t[0].nodeType===Node.ELEMENT_NODE?t.shift():l;if("number"===o.type&&o.validity&&o.validity.badInput){n.enabled&&console.warn("Reflex aborted: invalid numeric input");return}const s={};if(t[0]&&"object"===typeof t[0]&&Object.keys(t[0]).filter((e=>["attrs","selectors","reflexId","resolveLate","serializeForm","suppressLogging","includeInnerHTML","includeTextContent"].includes(e))).length){const e=t.shift();Object.keys(e).forEach((t=>s[t]=e[t]))}const i=new ReflexData(s,o,l,this.identifier,a.reflexPermanent,r,t,e,y);const c=i.reflexId;if(!this.isActionCableConnectionOpen())throw"The ActionCable connection is not open! `this.isActionCableConnectionOpen()` must return true before calling `this.stimulate()`";if(!b.subscriptionActive)throw"The ActionCable channel subscription for StimulusReflex was rejected.";l.reflexController=l.reflexController||{};l.reflexData=l.reflexData||{};l.reflexError=l.reflexError||{};l.reflexController[c]=this;l.reflexData[c]=i.valueOf();dispatchLifecycleEvent("before",o,l,c);setTimeout((()=>{const{params:e}=l.reflexData[c]||{};const t=o.attributes[a.reflexSerializeForm];t&&(s.serializeForm="false"!==t.value);const r=o.closest(i.formSelector)||document.querySelector(i.formSelector)||o.closest("form");d.enabled&&void 0===s.serializeForm&&r&&console.warn(`Deprecation warning: the next version of StimulusReflex will not serialize forms by default.\nPlease set ${a.reflexSerializeForm}="true" on your Reflex Controller Element or pass { serializeForm: true } as an option to stimulate.`);const n=false===s.serializeForm?"":serializeForm(r,{element:o});l.reflexData[c]={...i.valueOf(),params:e,formData:n};this.StimulusReflex.subscription.send(l.reflexData[c])}));const u=registerReflex(i.valueOf());p.request(c,r,t,this.context.scope.identifier,o,l);return u},__perform(e){let t=e.target;let r;while(t&&!r){r=t.getAttribute(a.reflex);r&&r.trim().length||(t=t.parentElement)}const l=attributeValues(r).find((t=>t.split("->")[0]===e.type));if(l){e.preventDefault();e.stopPropagation();this.stimulate(l.split("->")[1],t)}}})};const y=uuidv4();const useReflex=(e,t={})=>{register(e,t)};document.addEventListener("cable-ready:after-dispatch-event",routeReflexEvent);document.addEventListener("cable-ready:before-inner-html",beforeDOMUpdate);document.addEventListener("cable-ready:before-morph",beforeDOMUpdate);document.addEventListener("cable-ready:after-inner-html",afterDOMUpdate);document.addEventListener("cable-ready:after-morph",afterDOMUpdate);window.addEventListener("load",m);var v={initialize:initialize,register:register,useReflex:useReflex,get debug(){return n.value},set debug(e){n.set(!!e)},get deprecate(){return d.value},set deprecate(e){d.set(!!e)}};export{v as default};

